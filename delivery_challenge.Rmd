---
title: "Delivery_Challenge"
author: "ww44ss"
date: "Oct  2014"
output: 
    html_document:
        keep_md: true
---

```{r "get data"}

#if getwd()=="delivery_challenge" {} else {setwd("delivery_challenge")}

delivery_data<-read.csv("delivery_data.csv")

##clean data
        ##data frame it
        delivery_data<-as.data.frame(delivery_data)
        #eliminate NA zipcodes
        delivery_data<-delivery_data[!is.na(delivery_data$pickup_zipcode),]
        ##ensure pruchase prices are finite
        delivery_data<-delivery_data[!is.na(delivery_data$purchase_price),]
        delivery_data<-delivery_data[delivery_data$purchase_price>0,]

##take a look at the structure and header of the data 

str(delivery_data)

head(delivery_data)


```


You have data on `r dim(delivery_data)[1]` transactions.  

###Frequency of Deliveries

First plot the number of deliveries by zipcode.  

```{r frequency of deliveries, echo=TRUE, results='asis', fig.align='center'}

require(xtable)
require(ggplot2)

#find frequencies

        deliveries <- as.data.frame(table(delivery_data$pickup_zipcode))

        #rename columns descriptively
        colnames(deliveries)<-c("pickup_zipcode", "freq")


        deliveries$pickup_zipcode <- as.character(deliveries$pickup_zipcode)


   
##plot the data
        P1 <- ggplot(deliveries, aes(x=factor(pickup_zipcode), y=freq))+geom_point()
        P1<- P1+xlab("zipcode")+ylab("deliveries")+ggtitle("Deliveries versus Zipcode")
        P1<-P1+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

        print(P1)

      
```
The above shows the number of deliveries by zipcode. There's obviously substantial variation with the mean `r mean(deliveries$freq)` deliveries per zipcode and a standard deviation of `r sd(deliveries$freq)`.  

The top zipcodes for deliveries are:  

```{r "table of top zipcodes", results='asis', fig.align='center'}

        ##create table output of top fifteen zip codes

        ##sort data by deliveries
        deliv_sorted<-deliveries[with(deliveries, order(-freq)),]        
        ##create html table
        delivtable<-xtable(t(deliv_sorted[1:15,]))
        ##print it
        print(delivtable, type="html", include.colnames=FALSE, html.table.attributes='class=mytable')

        ##the next 15
        delivtable<-xtable(t(deliv_sorted[15:30,]))
        ##print it
        print(delivtable, type="html", include.colnames=FALSE, html.table.attributes='class=mytable')


```

<style>
table.mytable {
  border: 10px;
  width: 80%;
  font-size: 14px;
  line-height: 20px;
  font-family: 'Trebuchet MS';
  font-weight: normal;
  color: black;
}
</style>

###Purchase Price by Zipcode

```{r "mean deliveries", echo=FALSE, fig.align='center'}

library(ggplot2)      #get ggplot library

        ##create plot using violing and log scales
        P1 <- ggplot(delivery_data, aes(x=factor(pickup_zipcode), y=purchase_price))+geom_violin(fill = "grey80", colour = "#3366FF")+scale_y_log10() #+geom_jitter(size=2, colour="blue", alpha=0.5)

        ##label the plot
        P1<- P1+xlab("zipcode")+ylab("purchase price")+ggtitle("Purchase Price versus Zipcode")
        ##fix the x-axis
        P1<-P1+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

print(P1)
```

```{r "zip code stats"}
require(plyr)
        ##use plyr to pull data into zipcode bundled stats
        ##some summary stats
        purchase_stats<-ddply(delivery_data,~pickup_zipcode,summarise,mean_price=mean(purchase_price),median_price=median(purchase_price), max_price=max(purchase_price))



        ##filter for complete cases
        purchase_stats<-purchase_stats[!is.na(purchase_stats$pickup_zipcode),]

        ##plot
        P1 <- ggplot(purchase_stats, aes(x=factor(pickup_zipcode), y=median_price))+geom_point()
        P1<- P1+xlab("zipcode")+ylab("purchase price")+ggtitle("Mean Purchase Price versus Zipcode")
        P1<-P1+coord_flip()

print(P1)

```



```{r "task two"}

require(plyr)   ##get plyr library

##Pull data appart for management table
        purchase_stats_mgt<-ddply(delivery_data,~pickup_zipcode,summarise,less_than_60=nrow(subset(purchase_price <=60)),btw_60_and_120=nrow(subset(purchace_price>60.0&&purchase_price <=120)), above_120=nrow(subset(purchase_price>120)))


purchase_stats_mgt

```
